<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>ProyectoAAG · Admin instalaciones</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #0f172a;
      --card: #020617;
      --border: #1f2937;
      --primary: #22c55e;
      --primary-soft: #052e16;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --danger: #f97373;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #020617, #020617 40%, #0b1120 100%);
      color: var(--text);
      padding: 1.5rem;
    }

    .app {
      max-width: 1100px;
      margin: 0 auto;
    }

    h1 {
      font-size: 1.6rem;
      margin-bottom: 0.4rem;
    }

    p {
      color: var(--muted);
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }

    .card {
      background: var(--card);
      border-radius: 16px;
      border: 1px solid var(--border);
      padding: 1rem 1.2rem;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.9);
      margin-bottom: 1rem;
    }

    .card-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.6rem;
    }

    .card-title {
      font-size: 1rem;
      font-weight: 600;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: 1.4fr 1fr;
      gap: 1.2rem;
    }

    @media (max-width: 900px) {
      .grid-2 {
        grid-template-columns: 1fr;
      }
    }

    .section-title {
      margin-top: 0.8rem;
      margin-bottom: 0.3rem;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
    }

    .field-label {
      font-size: 0.8rem;
      color: var(--muted);
      margin-bottom: 0.15rem;
    }

    .field {
      margin-bottom: 0.5rem;
    }

    .input, .select, .textarea {
      width: 100%;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #020617;
      color: var(--text);
      padding: 0.45rem 0.8rem;
      font-size: 0.9rem;
      outline: none;
      transition: border-color 0.15s, box-shadow 0.15s;
    }

    .textarea {
      border-radius: 10px;
      min-height: 70px;
      resize: vertical;
      padding: 0.5rem 0.7rem;
      line-height: 1.4;
    }

    .input:focus, .select:focus, .textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px var(--primary-soft);
    }

    .row {
      display: flex;
      gap: 0.6rem;
    }

    .row > div {
      flex: 1;
    }

    .checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      font-size: 0.8rem;
      margin-bottom: 0.5rem;
    }

    .checkbox-group label {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.2rem 0.55rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #020617;
      cursor: pointer;
    }

    .checkbox-group input {
      accent-color: var(--primary);
    }

    .btn-row {
      display: flex;
      gap: 0.6rem;
      margin-top: 0.8rem;
      flex-wrap: wrap;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 0.45rem 1rem;
      font-size: 0.85rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      white-space: nowrap;
    }

    .btn-primary {
      background: var(--primary);
      color: #022c22;
      font-weight: 600;
    }

    .btn-secondary {
      background: transparent;
      color: var(--muted);
      border: 1px solid var(--border);
    }

    .btn-ghost {
      background: transparent;
      color: var(--muted);
      border: 1px solid var(--border);
      font-size: 0.8rem;
      padding-inline: 0.7rem;
    }

    .status {
      margin-top: 0.7rem;
      font-size: 0.8rem;
      color: var(--muted);
    }

    .status.error {
      color: var(--danger);
    }

    .tag-list {
      font-size: 0.8rem;
      color: var(--muted);
    }

    .small {
      font-size: 0.78rem;
      color: var(--muted);
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>Admin ProyectoAAG</h1>
    <p>Zona privada para añadir instalaciones a Firestore. Debe iniciarse sesión para poder ver y usar el formulario.</p>

    <!-- TARJETA DE LOGIN -->
    <div id="loginCard" class="card">
      <div class="card-header-row">
        <div class="card-title">Acceso</div>
      </div>
      <p class="small">
        Usa el usuario y contraseña que hayas creado en Firebase Authentication (método Email/Password).
      </p>
      <form id="loginForm">
        <div class="field">
          <div class="field-label">Correo electrónico</div>
          <input id="loginEmail" class="input" type="email" required placeholder="tu_correo@ejemplo.com" />
        </div>
        <div class="field">
          <div class="field-label">Contraseña</div>
          <input id="loginPassword" class="input" type="password" required placeholder="********" />
        </div>
        <div class="btn-row">
          <button type="submit" class="btn btn-primary">Iniciar sesión</button>
        </div>
        <div id="loginStatus" class="status"></div>
      </form>
    </div>

    <!-- TARJETA DE ADMIN (OCULTA SI NO HAY LOGIN) -->
    <div id="adminCard" class="card" style="display:none;">
      <div class="card-header-row">
        <div class="card-title">Nueva instalación</div>
        <button id="btnLogout" type="button" class="btn btn-ghost">Cerrar sesión</button>
      </div>
      <p class="small" id="userInfo"></p>

      <form id="formInstalacion">
        <!-- =====================
             IDENTIFICACIÓN BÁSICA
             ===================== -->
        <div class="section-title">Identificación</div>

        <div class="field">
          <div class="field-label">Nombre de la instalación *</div>
          <input id="nombre" class="input" type="text" required placeholder="Ej: Albergue Santa María del Valle" />
        </div>

        <div class="row">
          <div class="field">
            <div class="field-label">Comunidad autónoma</div>
            <select id="comunidad" class="select">
              <option value="">Sin especificar</option>
              <option value="Andalucía">Andalucía</option>
              <option value="Aragón">Aragón</option>
              <option value="Asturias">Asturias</option>
              <option value="Islas Baleares">Islas Baleares</option>
              <option value="Canarias">Canarias</option>
              <option value="Cantabria">Cantabria</option>
              <option value="Castilla-La Mancha">Castilla-La Mancha</option>
              <option value="Castilla y León">Castilla y León</option>
              <option value="Cataluña">Cataluña</option>
              <option value="Comunidad Valenciana">Comunidad Valenciana</option>
              <option value="Extremadura">Extremadura</option>
              <option value="Galicia">Galicia</option>
              <option value="Comunidad de Madrid">Comunidad de Madrid</option>
              <option value="Región de Murcia">Región de Murcia</option>
              <option value="Navarra">Navarra</option>
              <option value="País Vasco">País Vasco</option>
              <option value="La Rioja">La Rioja</option>
              <option value="Ceuta">Ceuta</option>
              <option value="Melilla">Melilla</option>
            </select>
          </div>
          <div class="field">
            <div class="field-label">Provincia</div>
            <input id="provincia" class="input" type="text" placeholder="Ej: León" />
          </div>
        </div>

        <div class="row">
          <div class="field">
            <div class="field-label">Municipio / pueblo</div>
            <input id="municipio" class="input" type="text" placeholder="Ej: Cistierna" />
          </div>
          <div class="field">
            <div class="field-label">Dirección (si se conoce)</div>
            <input id="direccion" class="input" type="text" placeholder="Calle, km, parroquia..." />
          </div>
        </div>

        <div class="row">
          <div class="field">
            <div class="field-label">Tipo</div>
            <select id="tipo" class="select">
              <option value="">Sin especificar</option>
              <option value="Albergue">Albergue</option>
              <option value="Campamento">Campamento</option>
              <option value="Casa rural">Casa rural</option>
              <option value="Residencia">Residencia</option>
              <option value="Otro">Otro</option>
            </select>
          </div>
          <div class="field">
            <div class="field-label">Entorno</div>
            <select id="entorno" class="select">
              <option value="">Sin especificar</option>
              <option value="Montaña">Montaña</option>
              <option value="Playa">Playa</option>
              <option value="Rural">Rural</option>
              <option value="Urbano">Urbano</option>
              <option value="Otro">Otro</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="field">
            <div class="field-label">Uso principal</div>
            <select id="uso_principal" class="select">
              <option value="">Sin especificar</option>
              <option value="Campamento de verano">Campamento de verano</option>
              <option value="Convivencia fin de semana">Convivencia fin de semana</option>
              <option value="Retiro / espiritualidad">Retiro / espiritualidad</option>
              <option value="Formación">Formación</option>
              <option value="Multiuso">Multiuso</option>
            </select>
          </div>
          <div class="field">
            <div class="field-label">Régimen</div>
            <select id="regimen" class="select">
              <option value="">Sin especificar</option>
              <option value="PC">Pensión completa</option>
              <option value="MP">Media pensión</option>
              <option value="SA">Solo alojamiento</option>
              <option value="Alquiler íntegro">Alquiler íntegro</option>
              <option value="Otro">Otro</option>
            </select>
          </div>
        </div>

        <!-- CONTACTO -->
        <div class="section-title">Contacto</div>
        <div class="row">
          <div class="field">
            <div class="field-label">Teléfono</div>
            <input id="telefono" class="input" type="text" placeholder="Ej: 600 123 456" />
          </div>
          <div class="field">
            <div class="field-label">Email de contacto</div>
            <input id="email_contacto" class="input" type="email" placeholder="Ej: reservas@albergue.com" />
          </div>
        </div>

        <div class="field">
          <div class="field-label">Web oficial (si tiene)</div>
          <input id="web_oficial" class="input" type="url" placeholder="https://..." />
        </div>

        <!-- CAPACIDAD -->
        <div class="section-title">Capacidad y estancias</div>
        <div class="row">
          <div class="field">
            <div class="field-label">Plazas mínimas recomendadas</div>
            <input id="plazas_min" class="input" type="number" min="0" placeholder="Ej: 40" />
          </div>
          <div class="field">
            <div class="field-label">Plazas máximas aproximadas</div>
            <input id="plazas_max" class="input" type="number" min="0" placeholder="Ej: 120" />
          </div>
        </div>

        <div class="row">
          <div class="field">
            <div class="field-label">Nº de habitaciones / salas de dormir</div>
            <input id="habitaciones" class="input" type="text" placeholder="Ej: 10 habitaciones de 8" />
          </div>
          <div class="field">
            <div class="field-label">Baños / duchas</div>
            <input id="banos" class="input" type="text" placeholder="Ej: 6 baños y 10 duchas" />
          </div>
        </div>

        <!-- SERVICIOS CERCANOS -->
        <div class="section-title">Servicios cercanos</div>
        <div class="row">
          <div class="field">
            <div class="field-label">Distancia a supermercado</div>
            <input id="distancia_supermercado" class="input" type="text" placeholder="Ej: 5 km en coche" />
          </div>
          <div class="field">
            <div class="field-label">Distancia a centro médico</div>
            <input id="distancia_centro_medico" class="input" type="text" placeholder="Ej: 20 min en coche" />
          </div>
        </div>

        <!-- NORMAS / SEGURIDAD -->
        <div class="section-title">Normas y seguridad</div>
        <div class="field">
          <div class="field-label">Restricciones / normas relevantes</div>
          <textarea id="restricciones" class="textarea" placeholder="Ej: Silencio a partir de las 23:00, no se puede usar piscina por la noche..."></textarea>
        </div>

        <div class="row">
          <div class="field">
            <div class="field-label">Horarios de silencio</div>
            <input id="horarios_silencio" class="input" type="text" placeholder="Ej: 23:00–8:00" />
          </div>
          <div class="field">
            <div class="field-label">Límite de tamaño de grupo</div>
            <input id="limite_grupos" class="input" type="text" placeholder="Ej: Máx. 80 personas por grupo" />
          </div>
        </div>

        <div class="field">
          <div class="field-label">Riesgos cercanos</div>
          <textarea id="riesgos_cercanos" class="textarea" placeholder="Río cercano, carretera, barranco, etc."></textarea>
        </div>

        <!-- CARACTERÍSTICAS -->
        <div class="section-title">Características de la instalación</div>
        <div class="checkbox-group">
          <label><input id="piscina" type="checkbox" />Piscina</label>
          <label><input id="tiene_campo_deportivo" type="checkbox" />Campo deportivo</label>
          <label><input id="zona_exterior_grande" type="checkbox" />Zona exterior grande</label>
          <label><input id="sombra_exterior" type="checkbox" />Zona con sombra</label>
          <label><input id="cocina_industrial" type="checkbox" />Cocina industrial</label>
          <label><input id="cocina_propia" type="checkbox" />Cocina propia</label>
          <label><input id="sala_multiusos" type="checkbox" />Sala multiusos</label>
          <label><input id="transporte_publico" type="checkbox" />Transporte público cercano</label>
          <label><input id="acceso_bus" type="checkbox" />Acceso bus grande</label>
          <label><input id="parking" type="checkbox" />Parking</label>
          <label><input id="accesible" type="checkbox" />Accesible</label>
          <label><input id="alquiler_exclusivo" type="checkbox" />Alquiler exclusivo</label>
          <label><input id="calefaccion" type="checkbox" />Calefacción</label>
          <label><input id="aire_acondicionado" type="checkbox" />Aire acondicionado</label>
          <label><input id="vallado" type="checkbox" />Recinto vallado</label>
          <label><input id="zona_tiendas_campana" type="checkbox" />Zona para montar tiendas</label>
          <label><input id="espacio_intendencia" type="checkbox" />Espacio intendencia / botiquín</label>
        </div>

        <!-- NOTAS / VALORACIÓN -->
        <div class="section-title">Notas internas / valoración</div>
        <div class="field">
          <div class="field-label">Notas públicas (lo que verán los demás)</div>
          <textarea id="notas_publicas" class="textarea" placeholder="Ej: Muy buen trato, perfecto para grupos de 50–70, recomendable para monitores novatos..."></textarea>
        </div>

        <div class="row">
          <div class="field">
            <div class="field-label">Valoración interna (1–5)</div>
            <input id="valoracion_interna" class="input" type="number" min="0" max="5" step="1" placeholder="Ej: 4" />
          </div>
        </div>

        <div class="section-title">Acciones</div>
        <div class="btn-row">
          <button type="submit" class="btn btn-primary">Guardar instalación</button>
          <button type="button" id="btnLimpiar" class="btn btn-secondary">Limpiar formulario</button>
        </div>

        <div id="status" class="status"></div>

        <div class="section-title">Recordatorio</div>
        <div class="tag-list">
          Campos que no se conozcan: déjalos vacíos, el sistema los tratará como “Sin información”.
        </div>
      </form>
    </div>
  </div>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>

  <script>
    // MISMA CONFIG QUE EN LA WEB PÚBLICA
    const firebaseConfig = {
      apiKey: "AIzaSyD_qFTqRsPwHTO9P8nyfikyWSAV1kt7k90",
      authDomain: "red-albergues.firebaseapp.com",
      projectId: "red-albergues",
      storageBucket: "red-albergues.firebasestorage.app",
      messagingSenderId: "325280024828",
      appId: "1:325280024828:web:1bc121e6089e105d386f79",
      measurementId: "G-JZXCJFMMEB"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // ELEMENTOS DOM LOGIN / ADMIN
    const loginCard = document.getElementById("loginCard");
    const adminCard = document.getElementById("adminCard");
    const loginForm = document.getElementById("loginForm");
    const loginEmail = document.getElementById("loginEmail");
    const loginPassword = document.getElementById("loginPassword");
    const loginStatus = document.getElementById("loginStatus");
    const userInfo = document.getElementById("userInfo");
    const btnLogout = document.getElementById("btnLogout");

    const form = document.getElementById("formInstalacion");
    const statusEl = document.getElementById("status");
    const btnLimpiar = document.getElementById("btnLimpiar");

    // Mostrar / ocultar según sesión
    auth.onAuthStateChanged((user) => {
      if (user) {
        loginCard.style.display = "none";
        adminCard.style.display = "block";
        userInfo.textContent = "Sesión iniciada como " + (user.email || "(usuario sin email)");
      } else {
        adminCard.style.display = "none";
        loginCard.style.display = "block";
        userInfo.textContent = "";
      }
    });

    // Login con email/contraseña
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      loginStatus.textContent = "Iniciando sesión...";
      loginStatus.classList.remove("error");

      try {
        const email = loginEmail.value.trim();
        const pass = loginPassword.value;
        await auth.signInWithEmailAndPassword(email, pass);
        loginStatus.textContent = "";
      } catch (error) {
        console.error(error);
        loginStatus.textContent = "Error al iniciar sesión: " + error.message;
        loginStatus.classList.add("error");
      }
    });

    // Logout
    btnLogout.addEventListener("click", () => {
      auth.signOut();
    });

    // Helpers de formulario instalación
    function valOrSinInfo(el) {
      const v = el.value.trim();
      return v === "" ? "Sin información" : v;
    }

    function limpiarFormulario() {
      form.reset();
      statusEl.textContent = "";
      statusEl.classList.remove("error");
    }

    btnLimpiar.addEventListener("click", limpiarFormulario);

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      statusEl.textContent = "Guardando...";
      statusEl.classList.remove("error");

      try {
        const ahora = firebase.firestore.FieldValue.serverTimestamp();

        const data = {
          nombre: document.getElementById("nombre").value.trim() || "Instalación sin nombre",
          comunidad: valOrSinInfo(document.getElementById("comunidad")),
          provincia: valOrSinInfo(document.getElementById("provincia")),
          municipio: valOrSinInfo(document.getElementById("municipio")),
          direccion: valOrSinInfo(document.getElementById("direccion")),
          tipo: valOrSinInfo(document.getElementById("tipo")),
          entorno: valOrSinInfo(document.getElementById("entorno")),
          uso_principal: valOrSinInfo(document.getElementById("uso_principal")),
          regimen: valOrSinInfo(document.getElementById("regimen")),

          telefono: valOrSinInfo(document.getElementById("telefono")),
          email_contacto: valOrSinInfo(document.getElementById("email_contacto")),
          web_oficial: valOrSinInfo(document.getElementById("web_oficial")),

          plazas_min: document.getElementById("plazas_min").value ? Number(document.getElementById("plazas_min").value) : null,
          plazas_max: document.getElementById("plazas_max").value ? Number(document.getElementById("plazas_max").value) : null,
          habitaciones: valOrSinInfo(document.getElementById("habitaciones")),
          banos: valOrSinInfo(document.getElementById("banos")),

          distancia_supermercado: valOrSinInfo(document.getElementById("distancia_supermercado")),
          distancia_centro_medico: valOrSinInfo(document.getElementById("distancia_centro_medico")),

          restricciones: valOrSinInfo(document.getElementById("restricciones")),
          horarios_silencio: valOrSinInfo(document.getElementById("horarios_silencio")),
          limite_grupos: valOrSinInfo(document.getElementById("limite_grupos")),
          riesgos_cercanos: valOrSinInfo(document.getElementById("riesgos_cercanos")),

          piscina: document.getElementById("piscina").checked,
          tiene_campo_deportivo: document.getElementById("tiene_campo_deportivo").checked,
          zona_exterior_grande: document.getElementById("zona_exterior_grande").checked,
          sombra_exterior: document.getElementById("sombra_exterior").checked,
          cocina_industrial: document.getElementById("cocina_industrial").checked,
          cocina_propia: document.getElementById("cocina_propia").checked,
          sala_multiusos: document.getElementById("sala_multiusos").checked,
          transporte_publico: document.getElementById("transporte_publico").checked,
          acceso_bus: document.getElementById("acceso_bus").checked,
          parking: document.getElementById("parking").checked,
          accesible: document.getElementById("accesible").checked,
          alquiler_exclusivo: document.getElementById("alquiler_exclusivo").checked,
          calefaccion: document.getElementById("calefaccion").checked,
          aire_acondicionado: document.getElementById("aire_acondicionado").checked,
          vallado: document.getElementById("vallado").checked,

          zona_tiendas_campana: document.getElementById("zona_tiendas_campana").checked,
          espacio_intendencia: document.getElementById("espacio_intendencia").checked,

          notas_publicas: valOrSinInfo(document.getElementById("notas_publicas")),
          valoracion_interna: document.getElementById("valoracion_interna").value
            ? Number(document.getElementById("valoracion_interna").value)
            : null,

          creado_en: ahora,
          ultima_actualizacion: ahora
        };

        await db.collection("instalaciones").add(data);

        statusEl.textContent = "Instalación guardada correctamente.";
        limpiarFormulario();
      } catch (err) {
        console.error(err);
        statusEl.textContent = "Error al guardar la instalación.";
        statusEl.classList.add("error");
      }
    });
  </script>
</body>
</html>
